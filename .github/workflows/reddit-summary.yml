name: Summarize Reddit subreddit 
on:
  schedule:
    - cron: "0 6 * * *"
  workflow_dispatch:
permissions:
  models: read
jobs:
  fetch-and-summarize:
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ github.token }}
    steps:
      - uses: actions/checkout@v5
      - name: Install gh models extension
        run: gh extension install https://github.com/github/gh-models
      - name: Fetch Reddit RSS
        run: curl -s https://www.reddit.com/r/java/.rss -o rss.xml
      - uses: keiranlovett/rss-feed-to-markdown@main
        with:
          feed_url: 'https://www.reddit.com/r/java/.rss'
          template_file: 'template.md'
          output_dir: '_posts/'
      - name: Run summarization via gh models
        run: cat _posts/* | gh models run --system-prompt "Summarize this RSS feed in a developer-friendly summary"
      - name: POST summary to webhook
        run: curl -X POST -F "file=@summary.txt" https://webhook.site/f8ca20d3-379e-418f-9aac-940cc00a9e2c
